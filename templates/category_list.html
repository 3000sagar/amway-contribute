{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- ===================================================================================== -->
<!-- â­ HERO SWIPER (GEN-Z LEVEL 2 UPGRADED) -->
<!-- ===================================================================================== -->

<div class="swiper productSwiper w-full 
            h-[260px] sm:h-[340px] md:h-[420px] lg:h-[460px]
            overflow-hidden mb-10 rounded-none md:rounded-xl">

    <div class="swiper-wrapper">

        {% for slide in slides %}
        <div class="swiper-slide">
            <div class="h-full w-full relative overflow-hidden rounded-xl px-6 sm:px-10 py-8
                        flex items-center justify-between transition-all duration-500 text-white"
                 style="background: linear-gradient(to right, {{ slide.gradient_from }}, {{ slide.gradient_to }});">

                <!-- ðŸ”¥ Animated neon gradient overlay -->
                <div class="absolute inset-0 animate-genzWave pointer-events-none
                            bg-[radial-gradient(circle_at_top_left,rgba(255,0,200,0.30),transparent_60%),
                               radial-gradient(circle_at_bottom_right,rgba(0,200,255,0.30),transparent_60%)]">
                </div>

                <!-- âœ¨ Floating particles -->
                <div class="absolute inset-0 overflow-hidden pointer-events-none">
                    <span class="heroParticle"></span>
                    <span class="heroParticle"></span>
                    <span class="heroParticle"></span>
                    <span class="heroParticle"></span>
                </div>

                <!-- â­ LEFT TEXT -->
                <div class="w-[55%] flex flex-col gap-2 relative z-10 animate-fadeUp">
                    <h2 class="text-xl sm:text-3xl md:text-4xl font-extrabold leading-tight
                               drop-shadow-[0_3px_10px_rgba(0,0,0,0.25)]">
                        {{ slide.title|safe }}
                    </h2>

                    <p class="text-sm sm:text-base opacity-95 drop-shadow-[0_2px_6px_rgba(0,0,0,0.2)]">
                        {{ slide.subtitle }}
                    </p>

                    <a href="#"
                       class="mt-4 w-fit bg-white text-black px-5 py-2 sm:px-6 sm:py-3
                              rounded-xl font-semibold text-xs sm:text-sm shadow-xl hover:scale-105 transition">
                        Explore Now
                    </a>
                </div>

                <!-- â­ RIGHT PRODUCT IMAGE -->
                <div class="w-[45%] flex justify-end items-center relative">

                    <!-- Floating neon glow circle -->
                    <div class="absolute right-0 animate-glowFloat
                                w-[240px] h-[240px]
                                sm:w-[300px] sm:h-[300px]
                                md:w-[360px] md:h-[360px]
                                bg-white/20 rounded-full blur-2xl">
                    </div>

                    <!-- Product image -->
                    <img src="{{ slide.image }}"
                         class="relative z-10 
                                w-[160px] sm:w-[220px] md:w-[300px] lg:w-[340px]
                                object-contain drop-shadow-2xl">
                </div>

            </div>
        </div>
        {% endfor %}

    </div>

    <div class="swiper-pagination"></div>
</div>




    <!-- ====================================================== -->
    <!-- â­ FLOATING PRODUCT TICKER (Slow Steady Version) -->
    <!-- ====================================================== -->

    <div class="ticker-container relative w-full my-10 overflow-hidden select-none">

      <div class="ticker-track flex gap-6 whitespace-nowrap px-2 py-2">

        {% for img in random_images %}
        <a href="/product/{{ img.product.slug }}/?highlight={{ img.id }}"
           class="ticker-item group relative flex-shrink-0
                  w-40 h-40 sm:w-48 sm:h-48 
                  bg-gray-100 dark:bg-gray-800 
                  rounded-xl overflow-hidden shadow-lg block">

          <img src="{{ img.image.url }}" 
               class="w-full h-full object-cover transition duration-300 group-hover:brightness-75">

          <!-- Overlay -->
          <div class="absolute inset-0 flex flex-col items-center justify-center gap-3 
                      opacity-0 group-hover:opacity-100 transition duration-300 
                      bg-black/40 text-white backdrop-blur-sm">

            <span class="px-3 py-1 bg-white text-black rounded-lg text-xs shadow">
              <i class="fa-solid fa-download mr-1"></i> Download
            </span>

            <div class="flex gap-4 text-xl share-icons">
              <i class="fab fa-instagram share-icon" data-platform="instagram"></i>
              <i class="fab fa-twitter share-icon" data-platform="twitter"></i>
              <i class="fab fa-whatsapp share-icon" data-platform="whatsapp"></i>
              <i class="fab fa-facebook share-icon" data-platform="facebook"></i>
            </div>

          </div>

        </a>
        {% endfor %}

      </div>
    </div>



<!-- ===================================================================================== -->
<!-- â­ TICKER CSS -->
<!-- ===================================================================================== -->

<style>
.ticker-container::-webkit-scrollbar { display: none; }
.ticker-container { scrollbar-width: none; }

.ticker-track { will-change: scroll-position, transform; cursor: grab; }
.ticker-track.dragging { cursor: grabbing; }

.ticker-item { transition: transform .25s ease, filter .25s ease; }
.ticker-item:hover { transform: scale(1.05); filter: brightness(0.9); }
</style>

<style>

/* Neon gradient wave animation */
@keyframes genzWave {
  0% {opacity:.5; transform:scale(1);}
  50% {opacity:.8; transform:scale(1.03);}
  100% {opacity:.5; transform:scale(1);}
}
.animate-genzWave {
  animation: genzWave 6s ease-in-out infinite;
}

/* Floating glow circle */
@keyframes glowFloat {
  0% {transform:translateY(0) scale(1);}
  50% {transform:translateY(-12px) scale(1.05);}
  100% {transform:translateY(0) scale(1);}
}
.animate-glowFloat {
  animation: glowFloat 5s ease-in-out infinite;
}

/* Text fade-up */
@keyframes fadeUp {
  0% {opacity:0; transform:translateY(20px);}
  100% {opacity:1; transform:translateY(0);}
}
.animate-fadeUp {
  animation: fadeUp 1.1s ease-out;
}

/* Floating particles */
.heroParticle {
  position:absolute;
  width:14px;
  height:14px;
  background:rgba(255,255,255,0.25);
  border-radius:50%;
  filter:blur(8px);
  animation: particleFloat 8s infinite linear;
}

.heroParticle:nth-child(1) {top:20%; left:10%; animation-duration:7s;}
.heroParticle:nth-child(2) {top:60%; left:30%; animation-duration:9s;}
.heroParticle:nth-child(3) {top:40%; left:80%; animation-duration:6s;}
.heroParticle:nth-child(4) {top:75%; left:55%; animation-duration:10s;}

@keyframes particleFloat {
  0% {transform:translateY(0) translateX(0);}
  50% {transform:translateY(-20px) translateX(10px);}
  100% {transform:translateY(0) translateX(0);}
}

</style>


<script>
const container = document.querySelector(".ticker-container");
const track = document.querySelector(".ticker-track");

// Duplicate items â†’ infinite scroll
(function cloneItems() {
    const items = [...track.children];
    items.forEach(item => track.appendChild(item.cloneNode(true)));
})();

// ====================================================
// â­ FIXED AUTO-SCROLL USING translateX (WORKS 100%)
// ====================================================
let position = 0;
let speed = 0.25;          // steady slow speed
let targetSpeed = 0.25;
let hoverSpeed = 0.05;
let easing = 0.08;

// Hover slowdown
const tickerItems = document.querySelectorAll(".ticker-item");
const shareIcons  = document.querySelectorAll(".share-icon");

function slow() {
    targetSpeed = hoverSpeed;
}
function fast() {
    targetSpeed = 0.25;
}

tickerItems.forEach(i => {
    i.addEventListener("mouseenter", slow);
    i.addEventListener("mouseleave", fast);
});

shareIcons.forEach(i => {
    i.addEventListener("mouseenter", slow);
    i.addEventListener("mouseleave", fast);
});

// ====================================================
// â­ Autoscroll loop
// ====================================================
function animateTicker() {
    // Smooth transition
    speed += (targetSpeed - speed) * easing;

    position -= speed;

    const totalWidth = track.scrollWidth / 2;

    // Loop effect
    if (Math.abs(position) >= totalWidth) {
        position = 0;
    }

    track.style.transform = `translateX(${position}px)`;

    requestAnimationFrame(animateTicker);
}

animateTicker();

// ====================================================
// â­ Drag + Momentum physics (still working)
// ====================================================
let isDown = false, startX, lastX, velocity = 0, rafID;

container.addEventListener("mousedown", (e) => {
    isDown = true;
    startX = e.pageX - position;
    lastX = e.pageX;
    cancelAnimationFrame(rafID);
});

container.addEventListener("mousemove", (e) => {
    if (!isDown) return;

    const x = e.pageX;
    const walk = x - lastX;
    position += walk;
    velocity = walk;
    lastX = x;

    track.style.transform = `translateX(${position}px)`;
});

container.addEventListener("mouseup", () => {
    isDown = false;
    momentumScroll();
});

container.addEventListener("mouseleave", () => isDown = false);

function momentumScroll() {
    velocity *= 0.95;

    position += velocity;
    
    const totalWidth = track.scrollWidth / 2;
    if (Math.abs(position) >= totalWidth) position = 0;

    track.style.transform = `translateX(${position}px)`;

    if (Math.abs(velocity) > 0.3) {
        rafID = requestAnimationFrame(momentumScroll);
    } else {
        animateTicker();
    }
}
</script>





<!-- ===================================================================================== -->
<!-- â­ SHARE LOGIC -->
<!-- ===================================================================================== -->

<script>
(function () {

    const shareIcons = document.querySelectorAll(".share-icon");

    shareIcons.forEach(icon => {
        icon.addEventListener("click", (e) => {

            e.preventDefault();
            e.stopPropagation();

            const platform = icon.dataset.platform;

            const card = icon.closest("a");
            const imageEl = card.querySelector("img");
            const imgUrl = imageEl.src;
            const encoded = encodeURIComponent(imgUrl);

            let shareUrl = "";

            switch (platform) {
                case "whatsapp":
                    shareUrl = `https://api.whatsapp.com/send?text=${encoded}`;
                    break;

                case "facebook":
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encoded}`;
                    break;

                case "twitter":
                    shareUrl = `https://twitter.com/intent/tweet?url=${encoded}`;
                    break;

                case "instagram":
                    window.open("https://www.instagram.com/", "_blank");
                    return;
            }

            window.open(shareUrl, "_blank", "noopener");

        });
    });

})();
</script>



<!-- ===================================================================================== -->
<!-- â­ CATEGORY ICONS -->
<!-- ===================================================================================== -->

<h2 class="text-xl sm:text-2xl font-bold mb-6 dark:text-white text-center">
    Explore by Category
</h2>

<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-10 place-items-center mb-14">

    {% for category in categories %}
    <a href="{% url 'categories:category_detail' category.slug %}"
       class="flex flex-col items-center group">

        <div class="w-36 h-36 sm:w-40 sm:h-40 md:w-44 md:h-44
            rounded-full overflow-hidden
            border-4 border-gray-200 dark:border-gray-700
            bg-white dark:bg-gray-800 shadow-md
            transition-all duration-300 group-hover:shadow-xl group-hover:scale-110">
        <img src="{{ category.image.url }}" class="w-full h-full object-cover" />
        </div>

        <p class="mt-4 text-sm sm:text-base md:text-lg font-semibold text-gray-800 dark:text-gray-200 text-center">
            {{ category.name }}
        </p>

    </a>
    {% endfor %}
</div>



<!-- ===================================================================================== -->
<!-- â­ FEATURED PRODUCTS -->
<!-- ===================================================================================== -->

<h2 class="text-xl sm:text-2xl font-bold mb-5 text-center dark:text-white">
    Featured Products
</h2>

<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 mb-14">

{% for p in featured %}
<a href="/product/{{ p.slug }}/"
   class="group block bg-white dark:bg-gray-900 
          border border-gray-200 dark:border-gray-700 
          rounded-xl shadow-sm 
          hover:shadow-lg hover:-translate-y-1 
          transition-all duration-300 p-5">

    <div class="w-full h-36 sm:h-40 md:h-44 
                bg-white dark:bg-gray-800 
                rounded-xl overflow-hidden 
                border border-gray-100 dark:border-gray-700 
                flex items-center justify-center shadow-inner">

        {% with img=p.productimage_set.first %}
            {% if img %}
            <img src="{{ img.image.url }}"
                 class="max-h-full max-w-full object-contain transition-transform duration-300 group-hover:scale-110">
            {% elif p.image %}
            <img src="{{ p.image.url }}"
                 class="max-h-full max-w-full object-contain transition-transform duration-300 group-hover:scale-110">
            {% else %}
            <div class="w-full h-full bg-gray-200 dark:bg-gray-700"></div>
            {% endif %}
        {% endwith %}
    </div>

    <p class="line-clamp-2 mt-4 text-sm md:text-base font-semibold text-gray-900 dark:text-gray-200 leading-tight min-h-[40px]">
        {{ p.name }}
    </p>

</a>
{% endfor %}
</div>



<!-- ===================================================================================== -->
<!-- â­ SWIPER INIT -->
<!-- ===================================================================================== -->

<script>
new Swiper(".productSwiper", {
    slidesPerView: 1,
    autoplay: { delay: 2600, disableOnInteraction: false },
    pagination: { el: ".swiper-pagination", clickable: true },
});
</script>



{% endblock %}
